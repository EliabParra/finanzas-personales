<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transacciones - Finanzas Personales</title>
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Sección de Navegación Principal -->
        <nav class="header">
            <a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i> Dashboard</a>
            <a href="transacciones.html" class="nav-item active"><i class="fas fa-exchange-alt"></i> Transacciones</a>
            <a href="categorias.html" class="nav-item"><i class="fas fa-tags"></i> Categorías</a>
            <a href="presupuestos.html" class="nav-item"><i class="fas fa-chart-pie"></i> Presupuestos</a>
            <a href="analisis.html" class="nav-item"><i class="fas fa-chart-line"></i> Análisis</a>
        </nav>

        <!-- Sección de Transacciones con Filtros -->
        <div class="card" data-aos="fade-up">
            <div class="card-header">
                <h2 class="card-title">Todas las Transacciones 📊</h2>
                <button class="btn" id="openTransactionModalBtn"><i class="fas fa-plus-circle"></i> Nueva Transacción</button>
            </div>

            <div class="filters-section" data-aos="fade-up" data-aos-delay="50">
                <div class="filter-group">
                    <label for="filterType">Tipo</label>
                    <select id="filterType">
                        <option value="">Todos</option>
                        <option value="income">Ingreso</option>
                        <option value="expense">Egreso</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterCategory">Categoría</label>
                    <select id="filterCategory">
                        <option value="">Todas</option>
                        <option value="alimentacion">Alimentación</option>
                        <option value="transporte">Transporte</option>
                        <option value="ocio">Ocio</option>
                        <option value="servicios">Servicios</option>
                        <option value="salud">Salud</option>
                        <option value="educacion">Educación</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterStartDate">Desde</label>
                    <input type="date" id="filterStartDate">
                </div>
                <div class="filter-group">
                    <label for="filterEndDate">Hasta</label>
                    <input type="date" id="filterEndDate">
                </div>
                <div class="filter-group">
                    <label for="filterDescription">Descripción / Categoría</label>
                    <input type="text" id="filterDescription" placeholder="Buscar por texto...">
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-secondary" id="resetFiltersBtn"><i class="fas fa-redo"></i> Limpiar Filtros</button>
                    <button class="btn" id="applyFiltersBtn"><i class="fas fa-filter"></i> Aplicar Filtros</button>
                </div>
            </div>

            <div class="transactions-table-container" data-aos="fade-up" data-aos-delay="100">
                <table class="transactions-table">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Descripción</th>
                            <th>Categoría</th>
                            <th>Fecha</th>
                            <th>Monto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ejemplo de transacciones -->
                        <tr data-transaction-id="1">
                            <td data-label="Tipo">
                                <i class="fas fa-arrow-alt-circle-up transaction-type-icon type-expense"></i> Egreso
                            </td>
                            <td data-label="Descripción">Compras del supermercado</td>
                            <td data-label="Categoría">Alimentación</td>
                            <td data-label="Fecha">05 Jul, 2025</td>
                            <td data-label="Monto" class="transaction-amount-cell expense">-$75.50</td>
                            <td data-label="Acciones" class="action-buttons">
                                <button class="action-btn edit" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" title="Eliminar">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                        <tr data-transaction-id="2">
                            <td data-label="Tipo">
                                <i class="fas fa-arrow-alt-circle-down transaction-type-icon type-income"></i> Ingreso
                            </td>
                            <td data-label="Descripción">Pago de nómina</td>
                            <td data-label="Categoría">Ingresos</td>
                            <td data-label="Fecha">01 Jul, 2025</td>
                            <td data-label="Monto" class="transaction-amount-cell income">+$1,500.00</td>
                            <td data-label="Acciones" class="action-buttons">
                                <button class="action-btn edit" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" title="Eliminar">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                        <tr data-transaction-id="3">
                            <td data-label="Tipo">
                                <i class="fas fa-arrow-alt-circle-up transaction-type-icon type-expense"></i> Egreso
                            </td>
                            <td data-label="Descripción">Entradas de cine</td>
                            <td data-label="Categoría">Ocio</td>
                            <td data-label="Fecha">03 Jul, 2025</td>
                            <td data-label="Monto" class="transaction-amount-cell expense">-$25.00</td>
                            <td data-label="Acciones" class="action-buttons">
                                <button class="action-btn edit" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" title="Eliminar">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                        <tr data-transaction-id="4">
                            <td data-label="Tipo">
                                <i class="fas fa-arrow-alt-circle-up transaction-type-icon type-expense"></i> Egreso
                            </td>
                            <td data-label="Descripción">Gasolina para el coche</td>
                            <td data-label="Categoría">Transporte</td>
                            <td data-label="Fecha">02 Jul, 2025</td>
                            <td data-label="Monto" class="transaction-amount-cell expense">-$40.00</td>
                            <td data-label="Acciones" class="action-buttons">
                                <button class="action-btn edit" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" title="Eliminar">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                        <tr data-transaction-id="5">
                            <td data-label="Tipo">
                                <i class="fas fa-arrow-alt-circle-down transaction-type-icon type-income"></i> Ingreso
                            </td>
                            <td data-label="Descripción">Venta de artículos usados</td>
                            <td data-label="Categoría">Otros</td>
                            <td data-label="Fecha">04 Jul, 2025</td>
                            <td data-label="Monto" class="transaction-amount-cell income">+$120.00</td>
                            <td data-label="Acciones" class="action-buttons">
                                <button class="action-btn edit" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" title="Eliminar">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL PARA AGREGAR NUEVA TRANSACCIÓN (reutilizado del dashboard) -->
    <!-- Este modal se mantiene aquí para que puedas probarlo fácilmente si lo abres directamente -->
    <div class="modal-overlay" id="transactionModal">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeTransactionModalBtn">&times;</button>
            <h3 class="modal-title">Nueva Transacción 💸</h3>
            <form id="newTransactionForm">
                <div class="form-group">
                    <label for="transactionType">Tipo de Transacción</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="transactionType" value="income" checked> Ingreso
                        </label>
                        <label>
                            <input type="radio" name="transactionType" value="expense"> Egreso
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="amount">Monto</label>
                    <input type="number" id="amount" placeholder="Ej: 50.00" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="date">Fecha</label>
                    <input type="date" id="date" value="2025-07-11" required>
                </div>
                <div class="form-group">
                    <label for="category">Categoría</label>
                    <select id="category" required>
                        <option value="">Selecciona una categoría</option>
                        <option value="alimentacion">Alimentación</option>
                        <option value="transporte">Transporte</option>
                        <option value="ocio">Ocio</option>
                        <option value="servicios">Servicios</option>
                        <option value="salud">Salud</option>
                        <option value="educacion">Educación</option>
                        <option value="otros">Otros</option>
                        <!-- Las categorías personalizadas se añadirían aquí dinámicamente -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="description">Descripción (opcional)</label>
                    <input type="text" id="description" placeholder="Ej: Cena con amigos">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelTransactionBtn">Cancelar</button>
                    <button type="submit" class="btn">Guardar Transacción</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Script para AOS (animaciones) -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // Inicializar AOS
        AOS.init({
            duration: 800, // Duración de la animación en ms
            once: true,    // Si las animaciones deben ocurrir solo una vez
        });

        document.addEventListener('DOMContentLoaded', () => {
            const navItems = document.querySelectorAll('.main-nav .nav-item');
            const openTransactionModalBtn = document.getElementById('openTransactionModalBtn');
            const transactionModal = document.getElementById('transactionModal');
            const closeTransactionModalBtn = document.getElementById('closeTransactionModalBtn');
            const cancelTransactionBtn = document.getElementById('cancelTransactionBtn');
            const newTransactionForm = document.getElementById('newTransactionForm');

            // --- Lógica de Navegación ---
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    // e.preventDefault();
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    console.log(`Navegando a: ${item.textContent.trim()}`);
                    // Aquí iría tu lógica para cargar el contenido de la vista correspondiente
                    // Por ejemplo, si usas un router JS o cambias el display de los componentes
                });
            });

            // --- Lógica del Modal de Transacción (reutilizado del Dashboard) ---
            if (openTransactionModalBtn) { // Asegurarse de que el botón exista en esta vista
                openTransactionModalBtn.addEventListener('click', () => {
                    transactionModal.classList.add('show');
                });
            }

            if (closeTransactionModalBtn) {
                closeTransactionModalBtn.addEventListener('click', () => {
                    transactionModal.classList.remove('show');
                    newTransactionForm.reset();
                });
            }

            if (cancelTransactionBtn) {
                cancelTransactionBtn.addEventListener('click', () => {
                    transactionModal.classList.remove('show');
                    newTransactionForm.reset();
                });
            }

            if (transactionModal) {
                transactionModal.addEventListener('click', (e) => {
                    if (e.target === transactionModal) {
                        transactionModal.classList.remove('show');
                        newTransactionForm.reset();
                    }
                });
            }

            if (newTransactionForm) {
                newTransactionForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const type = document.querySelector('input[name="transactionType"]:checked').value;
                    const amount = document.getElementById('amount').value;
                    const date = document.getElementById('date').value;
                    const category = document.getElementById('category').value;
                    const description = document.getElementById('description').value;

                    console.log('Nueva Transacción (desde Modal):', { type, amount, date, category, description });
                    transactionModal.classList.remove('show');
                    newTransactionForm.reset();
                    alert('Transacción guardada con éxito (simulado)!');
                });
            }

            // Establecer la fecha actual por defecto en el input de fecha del modal
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateInput = document.getElementById('date');
            if (dateInput) {
                dateInput.value = `${year}-${month}-${day}`;
            }

            // --- Lógica de Filtros (solo interfaz, no funcionalidad de filtrado de datos) ---
            const applyFiltersBtn = document.getElementById('applyFiltersBtn');
            const resetFiltersBtn = document.getElementById('resetFiltersBtn');
            const filterType = document.getElementById('filterType');
            const filterCategory = document.getElementById('filterCategory');
            const filterStartDate = document.getElementById('filterStartDate');
            const filterEndDate = document.getElementById('filterEndDate');
            const filterDescription = document.getElementById('filterDescription');

            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', () => {
                    const filters = {
                        type: filterType.value,
                        category: filterCategory.value,
                        startDate: filterStartDate.value,
                        endDate: filterEndDate.value,
                        description: filterDescription.value
                    };
                    console.log('Aplicando filtros:', filters);
                    alert('Filtros aplicados (simulado)! Revisa la consola para los valores.');
                    // Aquí iría tu lógica para filtrar las transacciones mostradas
                });
            }

            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', () => {
                    filterType.value = '';
                    filterCategory.value = '';
                    filterStartDate.value = '';
                    filterEndDate.value = '';
                    filterDescription.value = '';
                    console.log('Filtros reseteados.');
                    alert('Filtros reseteados (simulado)!');
                    // Aquí iría tu lógica para recargar todas las transacciones sin filtros
                });
            }

            // --- Lógica de botones de acción en la tabla (Editar/Eliminar) ---
            const actionButtons = document.querySelectorAll('.action-btn');
            actionButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const transactionRow = e.currentTarget.closest('tr');
                    const transactionId = transactionRow.dataset.transactionId;
                    if (e.currentTarget.classList.contains('edit')) {
                        console.log(`Editar transacción con ID: ${transactionId}`);
                        alert(`Editar transacción ${transactionId} (simulado)!`);
                        // Aquí iría tu lógica para cargar los datos de la transacción en el modal de edición
                        // y abrir el modal (reutilizando el mismo modal de nueva transacción, pero prellenado)
                    } else if (e.currentTarget.classList.contains('delete')) {
                        const confirmDelete = confirm(`¿Estás seguro de que quieres eliminar la transacción ${transactionId}? (Simulado)`);
                        if (confirmDelete) {
                            console.log(`Eliminando transacción con ID: ${transactionId}`);
                            transactionRow.remove(); // Remover del DOM
                            alert(`Transacción ${transactionId} eliminada (simulado)!`);
                            // Aquí iría tu lógica para eliminar de IndexedDB
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
